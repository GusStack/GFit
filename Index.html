<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zero-Backend Fitness (Single File)</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root{
      --bg:#0b1021; --card:#111630; --text:#e5e7eb; --muted:#94a3b8; --accent:#60a5fa; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; --ring:#1d4ed8;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1021,#0b1021 60%,#0e142a);color:var(--text)}
    .app-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #1f2937;position:sticky;top:0;background:#0b1021cc;backdrop-filter:blur(6px)}
    .app-header h1{font-size:18px;margin:0} nav a{color:var(--muted);margin:0 8px;text-decoration:none} nav a:hover{color:var(--text)}
    #app{padding:16px;max-width:900px;margin:0 auto}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 6px 30px rgba(0,0,0,.25)}
    .btn{display:inline-flex;align-items:center;gap:8px;background:#0f172a;border:1px solid #1f2937;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.primary{background:var(--ring);border-color:#1e40af}.btn.success{background:var(--ok);border-color:#15803d}
    .btn.warn{background:var(--warn);border-color:#b45309}.btn.danger{background:var(--danger);border-color:#b91c1c}
    .input, select{background:#0b1021;border:1px solid #1f2937;color:var(--text);padding:10px 12px;border-radius:12px;width:100%}
    .grid{display:grid;gap:12px} .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))} .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .timer{font-size:56px;font-weight:700;letter-spacing:1px;text-align:center;margin:12px 0}
    .progress{height:10px;background:#0b1021;border:1px solid #1f2937;border-radius:20px;overflow:hidden}
    .progress > div{height:100%;background:linear-gradient(90deg,#60a5fa,#34d399)}
    .small{font-size:12px;color:var(--muted)} .label{font-size:12px;color:var(--muted);margin-bottom:6px}
    .row{display:flex;gap:8px;flex-wrap:wrap} .hidden{display:none}
    .app-footer{padding:16px;color:#9ca3af;text-align:center;border-top:1px solid #1f2937}
  </style>
</head>
<body>
  <header class="app-header">
    <h1>Zero-Backend Fitness</h1>
    <nav>
      <a href="#/">Home</a>
      <a href="#/hiit">HIIT</a>
      <a href="#/strength">Strength</a>
      <a href="#/settings">Settings</a>
    </nav>
  </header>

  <main id="app"></main>
  <footer class="app-footer">Offline-ish · No accounts · Your data stays in your browser</footer>

  <script type="module">
    // --- tiny router (hash) ---
    const mount = (routes) => {
      const app = document.getElementById('app');
      const render = () => {
        const hash = location.hash.slice(1) || '/';
        const view = routes[hash] || routes['/404'] || (() => '<h2>Not found</h2>');
        app.innerHTML = view();
      };
      addEventListener('hashchange', render);
      addEventListener('load', render);
      render();
    };

    // --- utilities ---
    const beep = (freq=880, dur=0.08) => {
      try{
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.frequency.value=freq; osc.connect(gain); gain.connect(ctx.destination);
        osc.start();
        gain.gain.setValueAtTime(0.2, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur);
        osc.stop(ctx.currentTime+dur);
      }catch(e){}
    };

    // --- fake local "DB" (one key) ---
    const DB_KEY = 'zbf:data';
    const getData = () => JSON.parse(localStorage.getItem(DB_KEY)||'{}');
    const setData = (o) => localStorage.setItem(DB_KEY, JSON.stringify(o||{}));

    // --- sample exercise pool (no files) ---
    const EXERCISES = [
      { id:'air-squat', name:'Air Squat', type:'strength', equipment:[], cues:['Knees track over toes','Chest up'] },
      { id:'pushup', name:'Push-Ups', type:'strength', equipment:[], cues:['Brace core','Elbows ~45°'] },
      { id:'burpee', name:'Burpee (no push-up)', type:'hiit', equipment:[], cues:['Land softly','Keep breathing'] },
      { id:'kb-swing', name:'Kettlebell Swing', type:'hiit', equipment:['kettlebell'], cues:['Hinge, not squat','Snap hips'] },
    ];

    // --- VIEWS ---
    const Home = () => `
      <section class="card">
        <h2>Today</h2>
        <p>Quick start either a <strong>HIIT</strong> session or a <strong>Strength</strong> workout.</p>
        <div class="row">
          <a class="btn primary" href="#/hiit">Start HIIT</a>
          <a class="btn" href="#/strength">Start Strength</a>
        </div>
      </section>
      <section class="card">
        <h3>Zero-backend by design</h3>
        <p class="small">All data stays in your browser. Export/Import in Settings (single file app).</p>
      </section>
    `;

    // HIIT Runner (Tabata-style baseline; can be adapted to EMOM/AMRAP later)
    const HiitRunner = () => {
      let state = { work:20, rest:10, rounds:8, phase:'ready', currentRound:0, startTs:0, duration:0 };
      const start = () => {
        state.phase='work'; state.currentRound=1; state.duration=state.work; state.startTs=performance.now();
        tick(); beep(880,0.08);
      };
      const tick = () => {
        if(state.phase==='done') return;
        const now = performance.now();
        const elapsed = (now - state.startTs)/1000;
        const left = Math.max(0, state.duration - elapsed);
        renderTick(left);
        if(left <= 0.01){
          if(state.phase==='work'){
            state.phase='rest'; state.duration=state.rest; state.startTs=performance.now(); beep(440,0.06);
          }else{
            if(state.currentRound >= state.rounds){ state.phase='done'; beep(660,0.2); }
            else { state.phase='work'; state.currentRound++; state.duration=state.work; state.startTs=performance.now(); beep(880,0.08); }
          }
        }
        if(state.phase!=='done') requestAnimationFrame(tick);
      };
      const renderTick = (secondsLeft) => {
        const total = state.phase==='work' ? state.work : state.rest;
        const pct = total ? (100*((total - secondsLeft)/total)) : 0;
        const $ = (id) => document.getElementById(id);
        $('hiit-time').textContent = Math.ceil(secondsLeft).toString();
        $('hiit-phase').textContent = state.phase.toUpperCase();
        $('hiit-bar').style.width = pct + '%';
        $('round-info').textContent = `${state.currentRound}/${state.rounds}`;
      };
      const onStart = (e) => {
        e.preventDefault();
        const $ = (id) => document.getElementById(id);
        state.work = parseInt($('work').value,10)||20;
        state.rest = parseInt($('rest').value,10)||10;
        state.rounds = parseInt($('rounds').value,10)||8;
        start();
      };
      // attach after DOM insert
      queueMicrotask(()=>document.getElementById('hiit-start').addEventListener('click', onStart));
      return `
        <section class="card">
          <h2>HIIT</h2>
          <div class="grid cols-3">
            <div><div class="label">Work (s)</div><input id="work" class="input" type="number" value="20" min="5" max="300"></div>
            <div><div class="label">Rest (s)</div><input id="rest" class="input" type="number" value="10" min="0" max="300"></div>
            <div><div class="label">Rounds</div><input id="rounds" class="input" type="number" value="8" min="1" max="50"></div>
          </div>
          <div class="row" style="margin-top:12px">
            <button id="hiit-start" class="btn primary">Start</button>
          </div>
        </section>
        <section class="card">
          <div class="small">Phase</div>
          <div id="hiit-phase" class="small">READY</div>
          <div class="timer" id="hiit-time">0</div>
          <div class="progress"><div id="hiit-bar" style="width:0%"></div></div>
          <div class="small">Round <span id="round-info">0/0</span></div>
        </section>
      `;
    };

    // Strength Runner (very small demo flow)
    const StrengthRunner = () => {
      const plan = [
        { name:'Goblet Squat', reps:10, sets:3, rest:60 },
        { name:'Push-Ups', reps:10, sets:3, rest:60 },
        { name:'Bent-Over Row', reps:12, sets:3, rest:60 }
      ];
      let i=0, setNum=1, resting=false, restEnd=0, currentRest=plan[0].rest;

      const startRest = (sec) => { resting=true; currentRest = sec; restEnd = performance.now()+sec*1000; tick(); };
      const completeSet = () => {
        const cur = plan[i];
        if(setNum < cur.sets){ setNum++; startRest(cur.rest); }
        else if(i < plan.length-1){ i++; setNum=1; startRest(90); }
        else { byId('strength-status').textContent = 'All done!'; beep(660,0.2); }
        renderDetails();
      };
      const tick = () => {
        if(!resting) return;
        const left = Math.max(0,(restEnd - performance.now())/1000);
        byId('rest-time').textContent = Math.ceil(left).toString();
        if(left<=0.01){ resting=false; beep(880,0.08); byId('rest-time').textContent='0'; }
        else requestAnimationFrame(tick);
      };
      const byId = (x)=>document.getElementById(x);
      const renderDetails = () => {
        const cur = plan[i];
        byId('ex-name').textContent = cur.name;
        byId('ex-sets').textContent = `${setNum}/${cur.sets}`;
        byId('ex-reps').textContent = `${cur.reps}`;
      };
      queueMicrotask(()=>{
        byId('set-done').addEventListener('click', (e)=>{ e.preventDefault(); completeSet(); });
        renderDetails();
      });
      return `
        <section class="card">
          <h2>Strength (Minimal Demo)</h2>
          <div class="grid cols-3">
            <div><div class="label">Exercise</div><div id="ex-name">—</div></div>
            <div><div class="label">Set</div><div id="ex-sets">—</div></div>
            <div><div class="label">Target Reps</div><div id="ex-reps">—</div></div>
          </div>
          <div class="row" style="margin-top:12px">
            <button id="set-done" class="btn success">Complete Set</button>
            <span id="strength-status" class="small"></span>
          </div>
        </section>
        <section class="card">
          <div class="label">Rest</div>
          <div class="timer" id="rest-time">0</div>
          <div class="small">Auto-beep when rest finishes.</div>
        </section>
      `;
    };

    // Settings (single-file: export/import the one localStorage key)
    const Settings = () => {
      const onExport = () => {
        const data = localStorage.getItem(DB_KEY) || '{}';
        const blob = new Blob([data], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='zbf-backup.json'; a.click();
        URL.revokeObjectURL(url);
      };
      const onImport = (e) => {
        const f = e.target.files?.[0]; if(!f) return;
        const r = new FileReader();
        r.onload = ()=>{ localStorage.setItem(DB_KEY, r.result); alert('Imported. Reload the app.'); };
        r.readAsText(f);
      };
      queueMicrotask(()=>{
        document.getElementById('exp').addEventListener('click', onExport);
        document.getElementById('imp').addEventListener('change', onImport);
        document.getElementById('clr').addEventListener('click', ()=>{ localStorage.clear(); alert('Cleared.'); });
      });
      return `
        <section class="card">
          <h2>Settings</h2>
          <div class="row">
            <button id="exp" class="btn">Export JSON</button>
            <label class="btn"><input id="imp" type="file" accept="application/json" class="hidden">Import JSON</label>
            <button id="clr" class="btn danger">Clear all data</button>
          </div>
          <p class="small">Single-file app. Everything stays in your browser.</p>
        </section>
      `;
    };

    const NotFound = () => `<section class="card"><h2>404</h2></section>`;

    // mount routes
    mount({ '/':Home, '/hiit':HiitRunner, '/strength':StrengthRunner, '/settings':Settings, '/404':NotFound });
  </script>
</body>
</html>
